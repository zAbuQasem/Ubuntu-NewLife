#!/usr/bin/env bash
# disk block: show remaining disk space only if usage >= 90% (i.e., free <=10%).
# By default checks root filesystem; allow BLOCK_INSTANCE to specify mount point.
THRESH=90
MP=${BLOCK_INSTANCE:-/}
# Use df in 1K blocks, skip header.
# Fields: Filesystem 1K-blocks Used Available Use% Mounted_on
read -r fs total used avail usep mount < <(df -kP "$MP" | awk 'NR==2') || exit 0
# Strip %
usep=${usep%%%}
if [[ -z $usep ]]; then exit 0; fi
if (( usep < THRESH )); then
  exit 0
fi
# Remaining in GiB
remain_g=$(awk -v a="$avail" 'BEGIN{printf("%.1f", a/1024/1024)}')
# Icon:  (font awesome)
echo " ${remain_g}G left (${usep}% used)"
